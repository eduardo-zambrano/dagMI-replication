# Replication Package

**Paper:** "Testing Causal DAG Structures via Moment Inequalities"
**Author:** Eduardo Zambrano

This repository contains all code and data necessary to reproduce the
computational results (Tables 1--4, 6--11, and the inline statistics in
Section 9.1) reported in the paper. Tables 5 and 12 contain qualitative
comparisons and Lean formalization mappings, respectively, and are not
generated by code.

## Related Repositories

| Repository | Description |
|------------|-------------|
| [dagMI](https://github.com/eduardo-zambrano/dagMI) | R package implementing the methodology |
| [DagTesting](https://github.com/eduardo-zambrano/DagTesting) | Lean 4 formalization of key theorems (0 sorry's) |

## Overview

The paper develops a moment inequality test for causal DAG structures
based on Carbery's multilinear generalization of the Cauchy--Schwarz
inequality. The test is implemented in the companion R package
[dagMI](https://github.com/eduardo-zambrano/dagMI) (v0.2.0). This
replication package calls `dagMI` to run all simulations and empirical
analyses, producing LaTeX table fragments that are imported directly
into the manuscript via `\input{}`.

## Requirements

### Software

| Software | Version tested | Notes |
|----------|---------------|-------|
| R | 4.5.2 | >= 4.0.0 required |
| dagMI | 0.2.0 | Installed from GitHub via `install.R` |
| wooldridge | 1.4.4 | Card (1995) data for Section 9.1 |
| Rcpp | 1.1.1 | Dependency of dagMI |
| RcppArmadillo | 15.2.3.1 | Dependency of dagMI |

**Optional packages** (for Table 4, method comparison):

| Package | Purpose |
|---------|---------|
| pcalg | LiNGAM comparison |
| CAM | Additive noise model comparison |

If optional packages are not installed, the corresponding columns in
Table 4 are filled with "---" and all other tables are unaffected.

### Hardware

Full-mode results reported in the paper were generated on an Apple M2
Pro (10 cores, 16 GB RAM) running macOS. Total wall-clock time for the
full pipeline is approximately 15--20 hours (single-threaded). No
specialized hardware is required; any modern workstation with >= 8 GB
RAM will suffice, though runtimes will vary with CPU speed.

## Installation

```bash
git clone https://github.com/eduardo-zambrano/dagMI-replication.git
cd dagMI-replication
Rscript install.R
```

The `install.R` script installs `dagMI` from GitHub and checks for
optional dependencies. It does not modify the user's library paths
beyond installing the listed packages.

## Reproducing the Results

### Full run (publication quality)

```bash
Rscript run_all.R
```

This executes all 11 scripts sequentially, using the same simulation
parameters as the paper (typically `n_sims = 50--200`, `B = 500`
bootstrap replicates). Expected runtime: **15--20 hours**.

### Quick validation run

```bash
Rscript run_all.R --quick
```

Runs the entire pipeline with reduced simulation parameters (`n_sims =
5`, `B = 30`) to verify that all scripts execute without error. Point
estimates will be noisy but qualitative patterns should be consistent.
Expected runtime: **~70 minutes**.

### Selective execution

```bash
Rscript run_all.R --section 8      # Only Section 8 experiments
Rscript run_all.R --experiment 3   # Only Experiment 3 (Table 4)
```

### Makefile targets

```bash
make tables    # Equivalent to: Rscript run_all.R
make quick     # Equivalent to: Rscript run_all.R --quick
make clean     # Remove all generated .tex files from output/
```

### Updating the paper

After a successful run, copy the generated tables into the paper
directory:

```bash
cp output/*.tex ../DAG_Testing/tables/
```

The paper (`dag_testing_paper.tex`) imports these files via `\input{}`
and can be recompiled with `pdflatex`.

## Repository Structure

```
dagMI-replication/
    README.md               This file
    install.R               Dependency installation script
    run_all.R               Master script with CLI options
    Makefile                GNU Make targets for convenience

    R/
        helpers.R           Shared utilities (write_tex_table, format_num, sim_params)

    section7/
        benchmark_computation.R

    section8/
        experiment01_size.R
        experiment02_power.R
        experiment03_comparison.R
        experiment04_bandwidth.R
        experiment05_ordering.R
        experiment06_power_beta.R
        experiment07_large_dag.R
        experiment08_robustness.R

    section9/
        iv_returns.R
        gene_network.R

    data/
        gtex_jak_stat.csv   GTEx v8 Whole Blood expression for 4 genes (755 x 4)
        README.md           Data provenance documentation

    output/
        *.tex               Generated LaTeX table fragments
```

## Script-to-Table Mapping

| Script | Output file | Paper reference | Description |
|--------|------------|-----------------|-------------|
| `section7/benchmark_computation.R` | `table01_computation.tex` | Table 1 (Sec. 7.3) | Computation time benchmarks |
| `section8/experiment01_size.R` | `table02_size.tex` | Table 2 (Sec. 8.1) | Empirical size under correct specification |
| `section8/experiment02_power.R` | `table03_power.tex` | Table 3 (Sec. 8.2) | Power: MI vs. CI tests |
| `section8/experiment03_comparison.R` | `table04_comparison.tex` | Table 4 (Sec. 8.3) | Method comparison (MI, CI, LiNGAM, ANM) |
| `section8/experiment04_bandwidth.R` | `table06_bandwidth.tex` | Table 6 (Sec. 8.4) | Bandwidth sensitivity |
| `section8/experiment05_ordering.R` | `table07_ordering.tex` | Table 7 (Sec. 8.5) | Ordering strategies |
| `section8/experiment06_power_beta.R` | `table08_power_beta.tex` | Table 8 (Sec. 8.6) | Power vs. effect size |
| `section8/experiment07_large_dag.R` | `table09_large_dag.tex` | Table 9 (Sec. 8.7) | Large DAG (n = 8) |
| `section8/experiment08_robustness.R` | `table10_robustness.tex` | Table 10 (Sec. 8.8) | Robustness to DGP misspecification |
| `section9/iv_returns.R` | `section9_iv_results.tex` | Sec. 9.1 (inline) | IV exclusion restriction test |
| `section9/gene_network.R` | `table11_gene_network.tex` | Table 11 (Sec. 9.2) | Gene regulatory network test |

## Data Sources

### Card (1995) -- Section 9.1

The instrumental variables analysis uses data from:

> Card, D. (1995). "Using Geographic Variation in College Proximity to
> Estimate the Return to Schooling." In *Aspects of Labour Market
> Behaviour: Essays in Honour of John Vanderkamp*, ed. L. N. Christofides,
> E. K. Grant, and R. Swidinsky, 201--222. University of Toronto Press.

The data (N = 3,010) are accessed programmatically via the `wooldridge`
R package (`data("card")`). Variables used: `nearc4` (proximity to
four-year college, instrument), `educ` (years of schooling, treatment),
`lwage` (log hourly wage, outcome).

### GTEx v8 -- Section 9.2

The gene regulatory network analysis uses RNA-seq expression data from:

> The GTEx Consortium (2020). "The GTEx Consortium Atlas of Genetic
> Regulatory Effects across Human Tissues." *Science*, 369(6509),
> 1318--1330. https://doi.org/10.1126/science.aaz1776

The file `data/gtex_jak_stat.csv` contains log2(TPM + 1)-transformed
expression levels for four genes (JAK2, STAT1, IRF1, GBP1) across 755
Whole Blood samples from GTEx v8. This subset was extracted from the
bulk RNA-seq gene TPM matrix available at the
[GTEx Portal](https://gtexportal.org/home/datasets). The full dataset
(~1.5 GB) is not redistributed here; only the four-gene subset needed
for replication is included.

## Output Format

Each script writes a `.tex` file containing a self-contained
`\begin{tabular}...\end{tabular}` block with `\toprule`, `\midrule`,
and `\bottomrule` delimiters (requiring the `booktabs` LaTeX package).
The paper wraps each block with `\begin{table}`, `\caption{}`,
`\label{}`, and footnotes, so that statistical content is generated
while presentational elements remain editable without re-running
simulations.

## Reproducibility Notes

- **Random seeds.** All simulation scripts set explicit seeds (`set.seed()`)
  for reproducibility. Results should be identical across runs on the same
  platform and R version. Minor numerical differences (< 0.01 in rejection
  rates) may arise across platforms due to floating-point arithmetic.

- **Simulation parameters.** Quick mode uses `n_sims = 5` Monte Carlo
  replications and `B = 30` bootstrap samples. Full mode uses the
  publication parameters specified in each script (typically `n_sims = 50`
  and `B = 500`). These are controlled by the `sim_params()` function in
  `R/helpers.R`.

- **Missing optional packages.** If `pcalg` or `CAM` are not installed,
  Experiment 3 (Table 4) omits the LiNGAM and/or ANM columns and prints
  a warning. All other experiments are unaffected.

## License

MIT

## Citation

If you use this replication package, please cite the paper:

```bibtex
@article{zambrano2026testing,
  title={Testing Causal {DAG} Structures via Moment Inequalities},
  author={Zambrano, Eduardo},
  year={2026},
  journal={Working paper}
}
```
